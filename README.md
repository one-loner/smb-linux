#Настройка SMB:
#Установка пакета SMB:
sudo apt-get install samba
#Бэкап изначальной конфигурации:
sudo mv /etc/samba/smb.conf /etc/samba/smb.conf.old
#Копируем файл конфигурации smb.conf:
sudo cp smb.conf /etc/samba/smb.conf
#Конфигурация сервера состоит из нескольких секций. Основная секция [global] и каждая шара будет настроена отдельной секцией, также обозначенной квадратными скобками. К примеру [share1], [share2], [Music], [Video] и т.д.
#Создадим файл smbusers - будет содержать логины и пароли (зашифрованные естественно) пользователей файлового сервера. А также создадим папку, которую будем расшаривать в сеть.
sudo touch /etc/samba/smbusers
sudo mkdir /opt/FirstTestShare
sudo chmod 0777 /opt/FirstTestShare
#Проверим конфигурацию и перезапустим службу и добавим её в автозапуск.
testparm -s
sudo service smbd restart
sudo systemctl enable smbd
#Создадим учётные записи для пользователей SMB.
sudo useradd -c "smbuser1" -s /sbin/nologin smbuser1
sudo useradd -c "smbuser2" -s /sbin/nologin smbuser2
sudo useradd -c "smbuser3" -s /sbin/nologin smbuser3
sudo smbpasswd -a smbuser1
sudo smbpasswd -a smbuser2
sudo smbpasswd -a smbuser3
#У нас create mask и directory mask настроены так, что файлы пользователя может редактировать либо он, либо кто-то из общей с ним группы. Для всех остальных только чтение. По умолчанию при создании пользователя под него в системе создается одноименная группа. Получается что у нас пользователь smbuser1 в группе smbuser1, а пользователь smbuser2 в группе smbuser2.Для пользователя smbuser1 в данной ситуации пользователь smbuser2 относится к категории "другие".
#В случае, если требуется групповая работа над файлами. Значит будем настраивать общую группу для пользователей smbuser1 и smbuser2.
#Делается это так.
#1.Создаем новую группу командой:
sudo groupadd group
#2. Устанавливаем группу group по умолчанию для пользователей smbuser1 и smbuser2
sudo usermod -aG group smbuser1
sudo usermod -aG group smbuser2
#3. И перезапускаем samba, чтобы пользователи перелогинились на шару (иначе новые настройки не применятся)
sudo service smbd restart
#4. Меняем настройки владельца для всех файлов, которые уже были созданы и для самой папки Group
sudo chown -R smbuser1:group /opt/FirstTestShare/Group
#В случае, если требуется принудительно закрыть сессию пользователя, необходимо использовать утилиту smbstatus. Вывод программы можно разделить на три части:
#1. Список открытых сессий (один пользователь можешь открыть их несколько как с одного компьютера, так и с нескольких). Ключевое поле тут PID. Это идентификатор сессии.
#2. Список открытых шар, с указанием pid сессии. 
#3. Список заблокированных на запись файлов.
#PID сессии равнозначен Proccess ID в ОС Linux. 
#Заблокированный файл в 3-м разделе будет иметь статус DENY_WRITE в поле DenyMode. Смотрим PID, идем в первый раздел и видим IP-компьютера. Мы можем попросить человека закрыть файл или закрываем сессию принудительно. Для этого находим PID залоченного файла и выполняем в консоли команду 
sudo kill -9 PID
